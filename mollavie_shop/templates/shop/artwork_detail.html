{% extends "shop/base.html" %}
{% load static %}

{% block title %}{{ artwork.name }} - Mollavie{% endblock %}

{% block content %}
<div class="card mx-auto shadow" style="max-width: 750px;">
    {% if artwork.image %}
  {% with artwork.image.url as image_url %}
    {% if image_url|slice:":7" == "/image/" %}
      <img src="https://res.cloudinary.com/dyemjyefz{{ image_url }}"
           class="img-fluid rounded-top"
           alt="{{ artwork.name }}"
           loading="lazy">
    {% else %}
      <img src="{{ image_url }}"
           class="img-fluid rounded-top"
           alt="{{ artwork.name }}"
           loading="lazy">
    {% endif %}
  {% endwith %}
{% else %}
  <img src="{% static 'shop/img/default.jpg' %}"
       class="img-fluid rounded-top"
       alt="Default placeholder image"
       loading="lazy">
{% endif %}


    <div class="card-body">
        <h1 class="card-title text-center mb-3">{{ artwork.name }}</h1>
        <div class="card-text text-start" style="font-size: 1.1rem;">
            {{ artwork.description|safe }}
        </div>
        <p class="card-text">Category: {{ artwork.category.name }}</p>
        <p class="card-text text-center mt-4" style="font-size:1.3em;"><strong>‚Ç¨{{ artwork.price }}</strong></p>
        {% if artwork.is_available %}
            <form action="{% url 'shop:create_checkout_session' artwork.id %}" method="POST">
                {% csrf_token %}
                <button type="submit" class="btn btn-success w-100" style="font-size:1.2em;">Buy Now</button>
            </form>
        {% else %}
            <p class="text-muted text-center">This piece has been sold.</p>
        {% endif %}

   {% if user.is_authenticated %}
  <form action="{% url 'shop:toggle_favorite' artwork.id %}" method="post">
    {% csrf_token %}
    <button type="submit" class="btn btn-outline-warning w-100 mt-2">
      {% if user in artwork.favorites.all %}
        ‚ù§Ô∏è Remove from Favorites
      {% else %}
        ü§ç Add to Favorites
      {% endif %}
    </button>
  </form>
{% endif %}

    </div>
</div>

{% endblock %}
